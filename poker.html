<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MABOOM Pokerç‹è€…</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { background: #1a1a2e; color: white; text-align: center; font-family: Arial; margin: 0; padding: 10px; }
    h1 { font-size: 24px; margin: 10px; }
    #game { margin: 20px; }
    .card { display: inline-block; width: 60px; height: 80px; background: #fff; border: 2px solid #000; border-radius: 5px; margin: 2px; font-size: 20px; line-height: 80px; }
    .hand { margin: 10px; }
    #player-hand, #ai-hand { margin: 10px; }
    #score { font-size: 28px; margin: 15px; }
    button { padding: 12px 25px; margin: 10px; font-size: 18px; background: #e94560; border: none; border-radius: 10px; color: white; cursor: pointer; }
    #leaderboard { margin: 20px; font-size: 16px; }
    table { margin: 0 auto; border-collapse: collapse; }
    th, td { padding: 8px; border: 1px solid #e94560; }
  </style>
</head>
<body>
  <h1>â™ ï¸ MABOOM Pokerç‹è€…</h1>
  <p>å¾·å·æ‰‘å…‹å•äººå¯¹æˆ˜AIï¼Œèµ¢å±€èµšå¸ï¼Œé«˜åˆ†é¢†$MABOOMç©ºæŠ•ï¼</p>
  <div id="score">å¸: 1000</div>
  <div id="game">
    <div id="player-hand" class="hand">ä½ çš„æ‰‹ç‰Œ: </div>
    <div id="community">å…¬å…±ç‰Œ: </div>
    <div id="ai-hand" class="hand">AIæ‰‹ç‰Œ: [éšè—]</div>
    <button onclick="startGame()">æ–°æ¸¸æˆ</button>
    <button onclick="betAndDeal()">ä¸‹æ³¨&å‘ç‰Œ</button>
    <button onclick="revealAndScore()">æ­ç‰Œ&ç»“ç®—</button>
    <button onclick="submitScore()">æäº¤åˆ†æ•°ä¸Šæ’è¡Œæ¦œ</button>
  </div>
  <div id="leaderboard"></div>

  <script>
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    let coins = 1000;
    let playerHand = [];
    let aiHand = [];
    let communityCards = [];
    let suits = ['â™ ï¸', 'â™¥ï¸', 'â™¦ï¸', 'â™£ï¸'];
    let ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

    // ç®€å•ç‰Œè¯„ä¼° (è¿”å›æ‰‹ç‰Œå¼ºåº¦åˆ†æ•°, æ›´é«˜æ›´å¥½)
    function evaluateHand(hand) {
      // æ’åºæ‰‹ç‰Œ
      hand.sort((a, b) => ranks.indexOf(a.rank) - ranks.indexOf(b.rank));
      // æ£€æŸ¥åŒèŠ±é¡ºã€ç›´ flush ç­‰ (ç®€åŒ–ç‰ˆ)
      let sameSuit = hand.every(card => card.suit === hand[0].suit);
      let straight = hand.length === 5 && hand.every((card, i) => i === 0 || ranks.indexOf(card.rank) === ranks.indexOf(hand[i-1].rank) + 1);
      if (sameSuit && straight) return 9; // åŒèŠ±é¡º
      let counts = {};
      hand.forEach(card => counts[card.rank] = (counts[card.rank] || 0) + 1);
      if (Object.values(counts).includes(4)) return 8; // å››æ¡
      if (Object.values(counts).includes(3) && Object.values(counts).includes(2)) return 7; // è‘«èŠ¦
      if (sameSuit) return 6; // åŒèŠ±
      if (straight) return 5; // é¡ºå­
      if (Object.values(counts).includes(3)) return 4; // ä¸‰æ¡
      if (Object.values(counts).filter(c => c === 2).length === 2) return 3; // ä¸¤å¯¹
      if (Object.values(counts).includes(2)) return 2; // ä¸€å¯¹
      return 1; // é«˜ç‰Œ
    }

    // å‘ç‰Œ
    function dealCard() {
      let suit = suits[Math.floor(Math.random() * 4)];
      let rank = ranks[Math.floor(Math.random() * 13)];
      return { suit, rank };
    }

    function startGame() {
      coins = 1000; // é‡ç½®å¸
      playerHand = [dealCard(), dealCard()];
      aiHand = [dealCard(), dealCard()];
      communityCards = [];
      updateDisplay();
      document.getElementById('score').innerText = 'å¸: ' + coins;
    }

    function betAndDeal() {
      if (coins < 100) { alert('å¸ä¸å¤Ÿï¼'); return; }
      coins -= 100; // ä¸‹æ³¨
      communityCards = [dealCard(), dealCard(), dealCard()]; // å‘3å¼ å…¬å…±ç‰Œ
      updateDisplay();
      document.getElementById('score').innerText = 'å¸: ' + coins;
    }

    function revealAndScore() {
      // å‘æœ€å2å¼ å…¬å…±ç‰Œ
      communityCards.push(dealCard(), dealCard());
      let playerFull = [...playerHand, ...communityCards];
      let aiFull = [...aiHand, ...communityCards];
      let playerScore = evaluateHand(playerFull.slice(0,5)); // é€‰æœ€ä½³5å¼ ç®€åŒ–
      let aiScore = evaluateHand(aiFull.slice(0,5));
      let win = playerScore > aiScore ? 1 : (playerScore < aiScore ? -1 : 0);
      if (win > 0) { coins += 300; alert('èµ¢äº†ï¼+300å¸'); } // èµ¢åŠ å¸
      else if (win < 0) { alert('è¾“äº†ï¼-100å¸'); coins -= 100; }
      else { coins += 100; alert('å¹³å±€ï¼+100å¸'); }
      updateDisplay(true); // æ­AIç‰Œ
      document.getElementById('score').innerText = 'å¸: ' + coins;
    }

    function updateDisplay(revealAI = false) {
      let playerHtml = playerHand.map(c => `<span class="card">${c.rank}${c.suit}</span>`).join('');
      document.getElementById('player-hand').innerHTML = 'ä½ çš„æ‰‹ç‰Œ: ' + playerHtml;
      let communityHtml = communityCards.map(c => `<span class="card">${c.rank}${c.suit}</span>`).join('');
      document.getElementById('community').innerHTML = 'å…¬å…±ç‰Œ: ' + communityHtml;
      let aiHtml = revealAI ? aiHand.map(c => `<span class="card">${c.rank}${c.suit}</span>`).join('') : '[éšè—]';
      document.getElementById('ai-hand').innerHTML = 'AIæ‰‹ç‰Œ: ' + aiHtml;
    }

    // æ’è¡Œæ¦œ (æœ¬åœ°, åæœŸæ¥TON)
    function submitScore() {
      const name = prompt('è¾“å…¥åå­—ä¸Šæ’è¡Œæ¦œ: ', 'ç©å®¶');
      if (name && coins > 0) {
        let lb = JSON.parse(localStorage.getItem('maboomPokerLB') || '[]');
        lb.push({ name, coins });
        lb.sort((a, b) => b.coins - a.coins);
        lb = lb.slice(0, 10);
        localStorage.setItem('maboomPokerLB', JSON.stringify(lb));
        alert('æäº¤æˆåŠŸï¼ä½ çš„å¸: ' + coins);
        showLeaderboard();
      }
    }

    function showLeaderboard() {
      const lb = JSON.parse(localStorage.getItem('maboomPokerLB') || '[]');
      let html = '<h3>ğŸ† æ’è¡Œæ¦œ (å¸æ•°)</h3><table><tr><th>æ’å</th><th>ç©å®¶</th><th>å¸</th></tr>';
      lb.forEach((item, i) => html += `<tr><td>${i+1}</td><td>${item.name}</td><td>${item.coins}</td></tr>`);
      html += '</table>';
      document.getElementById('leaderboard').innerHTML = html;
    }

    // åˆå§‹åŒ–
    startGame();
  </script>
</body>
</html>